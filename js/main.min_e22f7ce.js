var __reflect=this&&this.__reflect||function(e,t,n){e.__class__=t,n?n.push(t):n=[t],e.__types__=e.__types__?n.concat(e.__types__):n},__extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n},__awaiter=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(a,i){function o(e){try{l(r.next(e))}catch(t){i(t)}}function s(e){try{l(r["throw"](e))}catch(t){i(t)}}function l(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(o,s)}l((r=r.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(a)throw new TypeError("Generator is already executing.");for(;l;)try{if(a=1,i&&(o=i[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(i,n[1])).done)return o;switch(i=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,i=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(o=l.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){l.label=n[1];break}if(6===n[0]&&l.label<o[1]){l.label=o[1],o=n;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(n);break}o[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(r){n=[6,r],i=0}finally{a=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var a,i,o,s,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},__assign=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;r>n;n++){t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},Face=function(e){function t(t){var n=e.call(this)||this;return n.faceX=0,n.faceY=0,n.faceX=t.x,n.faceY=t.y,n}return __extends(t,e),t.prototype.draw=function(){var e=this;this.face=this.drawFace(),this.openMouth=this.drawOpenMouth(),this.shynessFace=this.drawShyness();var t=new Beards({faceX:this.faceX,faceY:this.faceY,touchBreadCb:function(t){return e.face.dispatchEvent(new egret.Event("touchBread",!1,!1,t))}});return this.drawBeardSkin(this.face),this.drawFaceLine(this.face),this.eyes=this.drawEyes(this.face),this.drawMouth(this.face),t.draw(this.face),this.face.touchEnabled=!0,this.face.addEventListener(egret.TouchEvent.TOUCH_MOVE,function(){SoundManager.getInstance().palyPullShoutSound()},this.face),this.face.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){SoundManager.getInstance().palyPullShoutSound()},this.face),this.face.addEventListener(egret.TouchEvent.TOUCH_END,function(){SoundManager.getInstance().stopPullShoutSound()},this.face),this.face.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){SoundManager.getInstance().stopPullShoutSound()},this.face),this.face},t.prototype.drawEyes=function(e){for(var t=[],n=[],r=0;2>r;r++){var a=new egret.Sprite,i=new egret.Sprite;n.push(a),t.push(i);var o=this.faceX-37.5+150*r/2,s=this.faceY-200;a.x=o,a.y=s,a.$anchorOffsetX=o,a.$anchorOffsetY=s,a.graphics.lineStyle(4,0),a.graphics.drawArc(o,s,10,0,Math.PI,!1),a.graphics.endFill(),a.rotation=180,e.addChild(a);var l=this.faceX-75+150*r,d=this.faceY-150;i.x=l,i.y=d,i.$anchorOffsetX=l,i.$anchorOffsetY=d,i.graphics.beginFill(0),i.graphics.drawCircle(l,d,12),i.graphics.endFill();egret.Tween.get(i,{loop:!0}).wait(2e3).to({scaleY:.1},100,egret.Ease.cubicInOut).to({scaleY:1},100,egret.Ease.cubicInOut);e.addChild(i)}return{eyeballs:t,eyebrows:n}},t.prototype.drawMouth=function(e){var t=new egret.Sprite;t.graphics.lineStyle(4,0),t.graphics.drawArc(this.faceX,this.faceY-100,20,0,Math.PI,!0),t.graphics.endFill(),e.addChild(t)},t.prototype.drawFaceLine=function(e){var t=new egret.Sprite;t.graphics.lineStyle(4,16753920),t.graphics.drawCircle(this.faceX,this.faceY,250),t.graphics.endFill(),e.addChild(t)},t.prototype.drawBeardSkin=function(e){var t=new egret.Sprite;t.graphics.beginFill(16119285),t.graphics.drawArc(this.faceX,2*this.faceY,250,0,Math.PI,!0),t.graphics.endFill(),t.scaleY=.5,e.addChild(t);var n=new egret.Sprite;n.graphics.beginFill(16119285),n.graphics.drawArc(this.faceX,this.faceY,250,0,Math.PI,!1),n.graphics.endFill(),e.addChild(n)},t.prototype.drawOpenMouth=function(){var e=new egret.Sprite;return e.graphics.lineStyle(4,0),e.graphics.beginFill(267386880),e.graphics.drawCircle(this.faceX,this.faceY-100,20),e.graphics.endFill(),e},t.prototype.drawFace=function(){var e=new egret.Sprite;e.x=this.faceX,e.y=this.faceY,e.$anchorOffsetX=this.faceX,e.$anchorOffsetY=this.faceY,e.graphics.beginFill(16773077),e.graphics.drawCircle(this.faceX,this.faceY,250),e.touchEnabled=!0;egret.Tween.get(e,{loop:!0}).to({scaleX:1.01,scaleY:1.01},1e3,egret.Ease.cubicInOut).to({scaleX:1,scaleY:1},1e3,egret.Ease.cubicInOut);return e},t.prototype.drawShyness=function(){for(var e=new egret.Sprite,t=this.faceY-113,n=0;2>n;n++)for(var r=0;3>r;r++){var a=this.faceX-85+10*r+155*n,i=new egret.Shape;i.x=a,i.y=t,i.anchorOffsetX=a,i.anchorOffsetY=t,i.graphics.lineStyle(4,16758465),i.graphics.moveTo(a,t-8),i.graphics.lineTo(a-4,t),i.graphics.endFill(),e.addChild(i)}return e},t.prototype.shyness=function(){var e=this;this.face.addChild(this.shynessFace),this.eyes.eyebrows.forEach(function(e){return e.rotation=0});var t=setTimeout(function(){e.eyes.eyebrows.forEach(function(e){return e.rotation=180}),e.shynessFace.parent&&e.shynessFace.parent.removeChild(e.shynessFace),clearTimeout(t)},600)},t.prototype.openMouthAction=function(){var e=this;this.face.addChild(this.openMouth);var t=setTimeout(function(){e.openMouth.parent&&e.openMouth.parent.removeChild(e.openMouth),clearTimeout(t)},300)},t}(egret.Sprite);__reflect(Face.prototype,"Face",["FaceInterface"]);var AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,n){function r(r){t.call(n,r,e)}if(RES.hasRes(e)){var a=RES.getRes(e);a?r(a):RES.getResAsync(e,r,this)}else RES.getResByUrl(e,r,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),SoundManager.getInstance(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.onProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Main=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(){this.drawGame()},t.prototype.drawGame=function(){var e=this,t=new Menu(this.stage.stageWidth,this.stage.stageHeight),n=new Game(this.stage.stageWidth,this.stage.stageHeight),r=new StartView(this.stage.stageWidth,this.stage.stageHeight),a=t.draw(),i=n.draw(),o=r.draw(),s=new egret.Event("startGame"),l=new egret.Event("changeHistory"),d=this;d.addChild(a);var c=function(){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return a.parent&&d.removeChild(a),i.parent&&d.removeChild(i),d.addChild(o),[4,r.showText()];case 1:return e.sent(),SoundManager.getInstance().playStartSound(),d.removeChild(o),i.dispatchEvent(s),d.addChild(i),SoundManager.getInstance().playBgSound(),[2]}})})};a.addEventListener("startGame",c,a),i.addEventListener("restart",c,a),i.addEventListener("gameOver",function(){a.dispatchEvent(l),SoundManager.getInstance().stopPullShoutSound()},i),i.addEventListener("backMenu",function(){i.parent.removeChild(i),d.addChild(a),SoundManager.getInstance().stopBgSound(),SoundManager.getInstance().stopPullShoutSound()},i)},t}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var StartView=function(){function e(e,t){this.stageW=e,this.stageH=t}return e.prototype.draw=function(){var e=new egret.Sprite;e.graphics.drawRect(0,0,this.stageW,this.stageH);var t=new egret.TextField;return t.textColor=0,t.text="START",t.size=50,e.addChild(t),t.width=this.stageW,t.height=this.stageH,t.textAlign=egret.HorizontalAlign.CENTER,t.verticalAlign=egret.VerticalAlign.MIDDLE,this.startText=t,e},e.prototype.showText=function(){var e=this;return new Promise(function(t){var n=egret.Tween.get(e.startText);n.to({size:100},500,egret.Ease.circIn).wait(200).call(t).to({size:50},500,egret.Ease.circIn)})},e}();__reflect(StartView.prototype,"StartView");var DebugPlatform=function(){function e(){}return e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,{nickName:"username"}]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,n,r){function a(e){t.call(r,e)}function i(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,i,null),n.call(r))}var o=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){t.call(r,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(e,n){window.JSONParseClass.setData(e),egret.callLater(function(){t.call(r,generateEUI2)},o)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(e.indexOf(".exml")>-1){var s=e.split("/");s.pop();var l=s.join("/")+"_EUI.json";generateJSON.paths[e]?egret.callLater(function(){t.call(r,generateJSON.paths[e])},this):RES.getResByUrl(l,function(n){window.JSONParseClass.setData(n),egret.callLater(function(){t.call(r,generateJSON.paths[e])},o)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){t.call(r,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,i,null),RES.getResByUrl(e,a,this,RES.ResourceItem.TYPE_TEXT)},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var BREAS_NUM=100,MIN_BREAS_NUM=Math.floor(.8*BREAS_NUM),BREAS_Y=50,factor=50,Beards=function(e){function t(n){var r=e.call(this)||this;return r.faceX=0,r.faceY=0,r.beards=[],r.beardsPool=[],r.touchBreadCb=function(){},r.removeBeard=function(e){e.drop=!0;var t=e.shape;return t.$touchEnabled=!1,new Promise(function(t){var n=setTimeout(function(){var a=r.beards.indexOf(e);e.drop=!1,egret.Tween.removeTweens(e.line),e.shape.parent.removeChild(e.shape),r.beards.splice(a,1),r.beardsPool.push(e),clearTimeout(n),t()},600)})},r.touchBeard=function(e,n,a){return __awaiter(r,void 0,void 0,function(){var r,i,o,s,l=this;return __generator(this,function(d){return r=this.findClosestBeards(a.$stageX,a.$stageY),i=a.$stageY>t.touchPositionRecrod.y?-1:1,o=a.$stageX>t.touchPositionRecrod.x?1:-1,t.touchPositionRecrod={x:a.$stageX,y:a.$stageY},this.touchBreadCb(r.length),r.forEach(function(t){t.body.applyForceLocal([.1*o,.1*i],[e.shape.x/factor,e.shape.y/factor]),l.removeBeard(t).then(function(){l.createBear(n,!0)})}),this.beards.length<.9*BREAS_NUM&&(s=setTimeout(function(){for(var e=0;++e<BREAS_NUM-l.beards.length;)l.createBear(n);clearTimeout(s)})),[2]})})},r.faceX=n.faceX,r.faceY=n.faceY,r.touchBreadCb&&(r.touchBreadCb=n.touchBreadCb),r.word=new p2.World({gravity:[0,.01]}),r.word.sleepMode=p2.World.BODY_SLEEPING,r.addEventListener(egret.Event.ENTER_FRAME,r.Update,r),r}return __extends(t,e),t.prototype.Update=function(){this.word.step(2.5),this.beards.filter(function(e){return e.drop}).forEach(function(e){Math.floor(e.shape.x)!==Math.floor(e.body.position[0]*factor)&&(e.shape.x=e.body.position[0]*factor),Math.floor(e.shape.y)!==Math.floor(e.body.position[1]*factor)&&(e.shape.y=e.body.position[1]*factor)})},t.prototype.draw=function(e){this.drawBeards(e),e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchStart,e)},t.prototype.drawBeard=function(e,t,n){var r=new p2.Box({radius:20/factor}),a=new p2.Body({mass:1,position:[e/factor,t/factor],collisionResponse:!1,ccdIterations:!1});a.addShape(r);var i=new egret.Sprite;i.x=e,i.y=t,i.anchorOffsetX=e,i.anchorOffsetY=t;var o=180*Math.atan2(.5*this.faceY-t,this.faceX-e)/Math.PI;i.rotation=o-90,i.graphics.beginFill(0,0),i.graphics.drawCircle(e,t-8,40),i.graphics.endFill(),i.touchEnabled=!0;var s=new egret.Shape;s.x=e,s.y=t,s.anchorOffsetX=e,s.anchorOffsetY=t,s.graphics.lineStyle(2,0);var l=t/100>5.5?Math.floor(t/100*.5):0;s.graphics.moveTo(e,t-(5+l)),s.graphics.lineTo(e,t),s.graphics.endFill(),s.scaleY=0;var d=egret.Tween.get(s);d.to({scaleY:1},300,egret.Ease.backInOut),i.addChild(s),this.word.addBody(a),a.displays=[i];var c={shape:i,line:s,body:a,drop:!1};return i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.touchBeard.bind(this,c,n),i,!0),i.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchBeard.bind(this,c,n),i,!0),c},t.prototype.reDrawBear=function(e,t,n){var r=this.beardsPool.pop();r.body.position[0]=e/factor,r.body.position[1]=t/factor,r.shape.graphics.clear(),r.shape.touchEnabled=!0,r.shape.x=e,r.shape.y=t,r.shape.$anchorOffsetX=e,r.shape.$anchorOffsetY=t;var a=180*Math.atan2(.5*this.faceY-t,this.faceX-e)/Math.PI;r.shape.rotation=a-90,r.shape.graphics.clear(),r.shape.graphics.beginFill(0,0),r.shape.graphics.drawCircle(e,t-8,40),r.shape.graphics.endFill(),r.line.$alpha=1,r.line.graphics.clear(),r.line.x=e,r.line.y=t,r.line.anchorOffsetX=e,r.line.anchorOffsetY=t,r.line.graphics.lineStyle(2,0);var i=t/100>5.5?Math.floor(t/100*.5):0;r.line.graphics.moveTo(e,t-(5+i)),r.line.graphics.lineTo(e,t),r.line.graphics.endFill(),r.line.scaleY=0;var o=egret.Tween.get(r.line);return o.to({scaleY:1},300,egret.Ease.backInOut),r.shape.addChild(r.line),r},t.prototype.findClosestBeards=function(e,t){var n=this.beards.filter(function(n){if(n.drop)return!1;var r=Math.abs(Math.sqrt(Math.pow(e-n.line.x,2)+Math.pow(t-n.line.y,2)));return 25>=r});return n},t.prototype.randomPoint=function(e,t,n,r){void 0===r&&(r=0);var a=2*Math.PI*Math.random(),i=Math.sqrt(Math.random())*e,o=t+i*Math.cos(a),s=n+i*Math.sin(a);return s<this.faceY-BREAS_Y&&3!=r?this.randomPoint(e,t,n,++r):[o,s]},t.prototype.createBear=function(e,t){void 0===t&&(t=!1);var n=this.randomPoint(250,this.faceX,this.faceY),r=n[0],a=n[1];if(a>this.faceY-BREAS_Y){var i=t?this.reDrawBear(r,a,e):this.drawBeard(r,a,e);this.beards.push(i),e.addChild(i.shape)}},t.prototype.drawBeards=function(e){for(var t=0;BREAS_NUM>t;t++)this.createBear(e)},t.prototype.touchStart=function(e){t.touchPositionRecrod={x:e.$stageX,y:e.$stageY}},t}(egret.Sprite);__reflect(Beards.prototype,"Beards",["BeardInterface"]);var Loading=function(){function e(){this.loading=document.querySelector(".loading"),this.loading_text=this.loading.querySelector(".text")}return e.getInstance=function(){return e.shared||(e.shared=new e),e.shared},e.prototype.show=function(e){e?this.loading_text.innerText=e:this.loading_text.innerText="加载中",this.loading.style.display="flex"},e.prototype.hide=function(){this.loading.style.display="none"},e}();__reflect(Loading.prototype,"Loading");var GAME_TIME_SECOUND=15,GAME_STORAGE_NAME="gameScoreRecode",PLAYNAME_STORAGE_NAME="playerName",Game=function(e){function t(t,n){var r=e.call(this)||this;return r.playing=!0,r.gameTime=GAME_TIME_SECOUND,r.firstPlay=!0,r.timer=null,r.expressionScore=0,r.useTime=0,r.stageW=t,r.stageH=n,r}return __extends(t,e),t.prototype.draw=function(){var e=this;this.playing=!1;var t=new egret.Event("backMenu"),n=new egret.Event("restart"),r=new egret.Event("gameOver"),a=this.drawResultView({backMenuCb:function(){return o.dispatchEvent(t)},restartCb:function(){return o.dispatchEvent(n)}}),i=this.drawIntoRankView(),o=new egret.Sprite;o.graphics.drawRect(0,0,this.stageW,this.stageH),o.graphics.endFill();var s=new Face({x:this.stageW/2,y:this.stageH/2,width:0,height:0}),l=s.draw(),d=new egret.TextField;d.size=30,d.textColor=0,d.text="返回",o.addChild(d),d.y=40,d.x=80,d.touchEnabled=!0,d.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){SoundManager.getInstance().playButtonSound(),clearTimeout(e.timer),e.playing=!1,o.dispatchEvent(t)},d);var c=new egret.TextField;c.size=60,c.text=GAME_TIME_SECOUND+"",c.textColor=0,o.addChild(c),c.y=this.stageH/2-400,c.width=this.stageW,c.textAlign=egret.HorizontalAlign.CENTER;var h=function(t){e.timer=setTimeout(function(){if(0!==e.gameTime){if(c.text=--e.gameTime+"",++e.useTime,0===e.gameTime)return void t();h(t)}},1e3)},u=function(){e.playing=!1,o.dispatchEvent(r)},g=0,p=new egret.TextField;p.size=30,p.textColor=0,p.text="得分："+g,p.y=40,p.x=this.stageW-200,o.addChild(p);var f=function(){e.expressionScore=0,e.useTime=0,l.touchChildren=!0,l.touchEnabled=!0,d.touchEnabled=!0,clearTimeout(e.timer),e.gameTime=GAME_TIME_SECOUND,g=0,p.text="得分："+g,c.text=e.gameTime+"",a.changeScore(0),a.view.parent&&a.view.parent.removeChild(a.view),e.playing=!0,h(u)},v=this.showText(o,"PERFECT",13369599,13408767),w=this.showText(o,"GOOD",16416882,16753920),y=this.showText(o,"NICE",49151,8900346),E=function(t){if(e.playing){var n=0;e.expressionScore+=t.data,1===e.useTime&&(e.expressionScore>=50?(n=20,SoundManager.getInstance().playLongShoutSound(),s.shyness(),s.openMouthAction(),e.shakeView(o),v.show()):e.expressionScore>=40?(n=15,SoundManager.getInstance().playShoutSound(),s.openMouthAction(),e.shakeView(o),w.show()):e.expressionScore>=30&&(n=10,SoundManager.getInstance().playNiceSound(),s.openMouthAction(),y.show()),e.expressionScore=0,e.useTime=0),g+=t.data,p.text="得分："+(g+n)}};return i.view.addEventListener("finish",function(e){o.removeChild(i.view),a.changeScore(e.data),o.addChild(a.view)},i),o.addEventListener("startGame",f,o),o.addEventListener("restart",f,o),l.addEventListener("touchBread",E,l),o.addEventListener("gameOver",function(){return __awaiter(e,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return this.expressionScore=0,this.useTime=0,l.touchChildren=!1,l.touchEnabled=!1,d.touchEnabled=!1,e=-1,0===g||IS_LOCAL?[3,2]:(Loading.getInstance().show(),[4,this.checkScoreIntoRank(g)]);case 1:e=n.sent(),Loading.getInstance().hide(),n.label=2;case 2:return-1!==e?(SoundManager.getInstance().playWoWSound(),i.changeScore(g),i.changeRank(e),o.addChild(i.view)):(a.changeScore(g),o.addChild(a.view)),t=egret.localStorage.getItem(GAME_STORAGE_NAME),t?Number(g)>Number(t)&&egret.localStorage.setItem(GAME_STORAGE_NAME,g+""):egret.localStorage.setItem(GAME_STORAGE_NAME,g+""),[2]}})})},o),o.addChild(l),o},t.prototype.drawResultView=function(e){var t=this,n=e.restartCb,r=e.backMenuCb,a=new egret.Sprite;a.zIndex=999,a.graphics.beginFill(0,.4),a.graphics.drawRect(0,0,this.stageW,this.stageH),a.graphics.endFill();var i=new egret.Sprite;i.graphics.lineStyle(5,0),i.graphics.beginFill(16777215),i.graphics.drawRoundRect(0,0,500,500,20,20),i.x=this.stageW/2-250,i.y=this.stageH/2-250,i.graphics.endFill();var o=new egret.TextField;o.textColor=0,o.size=45,o.text="时间到～";var s=new egret.TextField;s.textColor=0,s.text="你的得分是：",s.size=35;var l=new egret.TextField;l.text="重新开始",l.size=30,l.textColor=0,l.touchEnabled=!0;var d=new egret.TextField;return d.text="返回菜单",d.size=30,d.textColor=0,d.touchEnabled=!0,i.addChild(l),i.addChild(d),i.addChild(o),i.addChild(s),o.width=500,o.y=40,o.textAlign=egret.HorizontalAlign.CENTER,s.width=500,s.y=120,s.textAlign=egret.HorizontalAlign.CENTER,l.width=500,l.y=300,l.textAlign=egret.HorizontalAlign.CENTER,l.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){SoundManager.getInstance().playButtonSound(),n&&n.bind(t)()},l),d.width=500,d.y=380,d.textAlign=egret.HorizontalAlign.CENTER,d.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){SoundManager.getInstance().playButtonSound(),r&&r.bind(t)()},d),a.addChild(i),{view:a,changeScore:function(e){s.text="你的得分是："+e}}},t.prototype.drawIntoRankView=function(){var e=this,t=0,n=new egret.Sprite;n.zIndex=999,n.graphics.beginFill(0,.4),n.graphics.drawRect(0,0,this.stageW,this.stageH),n.graphics.endFill();var r=new egret.Sprite;r.graphics.lineStyle(5,0),r.graphics.beginFill(16777215),r.graphics.drawRoundRect(0,0,500,500,20,20),r.x=this.stageW/2-250,r.y=this.stageH/2-250,r.graphics.endFill();var a=new eui.Image;a.source="resource/assets/cd.png",a.width=1028,a.height=856,a.x=-300,a.y=130,n.addChild(a);var i=new egret.TextField;i.textColor=0,i.size=35,i.text="你的成绩进入排行榜啦～",i.width=500,i.y=40,i.textAlign=egret.HorizontalAlign.CENTER,r.addChild(i);var o=new egret.TextField;o.textColor=0,o.size=24,o.width=400,o.y=120,o.x=50,o.lineSpacing=10,o.textAlign=egret.HorizontalAlign.CENTER,r.addChild(o);var s=new egret.TextField;s.textColor=0,s.text="请在下面输入框输入你的名称",s.size=18,s.width=300,s.y=230,s.x=100,s.textAlign=egret.HorizontalAlign.CENTER,r.addChild(s);var l=new eui.TextInput,d='<e:Skin class="skins.TextInputSkin" minHeight="40" minWidth="300" states="normal,disabled,normalWithPrompt,disabledWithPrompt" xmlns:e="http://ns.egret.com/eui">\n            <e:Rect height="100%" width="100%" strokeColor="0x000000" strokeWeight="2" fillColor="0xffffff"/>\n            <e:EditableText id="textDisplay" verticalCenter="0" left="10" right="10" textColor="0x000000" textColor.disabled="0xff0000" width="100%" height="24" size="20" />\n            <e:Label id="promptDisplay" verticalCenter="0" left="10" right="10" textColor="0xa9a9a9" width="100%" height="24" size="20" touchEnabled="false" includeIn="normalWithPrompt,disabledWithPrompt"/>\n        </e:Skin>';l.skinName=d,l.prompt="请输入昵称",l.y=260,l.x=50,l.width=400,l.height=50,r.addChild(l);var c=new egret.TextField;c.textColor=16711680,c.text="请在上面输入框输入你的名称",c.size=18,c.width=300,c.y=320,c.x=100,c.textAlign=egret.HorizontalAlign.CENTER,c.alpha=0,r.addChild(c);var h=new egret.TextField;h.text="确定",h.size=24,h.touchEnabled=!0,h.textColor=0,h.width=100,h.y=400,h.x=100,h.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return __awaiter(e,void 0,void 0,function(){var e;return __generator(this,function(r){switch(r.label){case 0:if(!l.text)return c.alpha=1,[2];c.alpha=0,r.label=1;case 1:return r.trys.push([1,,3,4]),Loading.getInstance().show(),[4,Http.PostRequest("/api/rank",{playerName:l.text,score:t})];case 2:return e=r.sent(),localStorage.setItem(PLAYNAME_STORAGE_NAME,l.text),Loading.getInstance().hide(),[3,4];case 3:return SoundManager.getInstance().playButtonSound(),n.dispatchEvent(new egret.Event("finish",!1,!1,t)),[7];case 4:return[2]}})})},h),r.addChild(h);var u=new egret.TextField;return u.text="取消",u.size=24,u.touchEnabled=!0,u.textColor=0,u.width=100,u.y=400,u.x=350,u.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){SoundManager.getInstance().playButtonSound(),n.dispatchEvent(new egret.Event("finish",!1,!1,t))},u),r.addChild(u),n.addChild(r),{view:n,changeRank:function(e){c.alpha=0,localStorage.getItem(PLAYNAME_STORAGE_NAME)&&(l.text=localStorage.getItem(PLAYNAME_STORAGE_NAME)),o.textFlow=[{text:"恭喜你进入排行榜第",style:{textColor:0,size:24}},{text:" "+e+" ",style:{textColor:16731471,size:30,bold:!0}},{text:"名，留下你的",style:{textColor:0,size:24}},{text:"「掘金昵称」",style:{textColor:32767,size:24,bold:!0}},{text:"让更多人来挑战你吧",style:{textColor:0,size:24}}]},changeScore:function(e){t=e}}},t.prototype.shakeView=function(e){egret.Tween.get(e).to({x:-8},50,egret.Ease.cubicInOut).to({x:8},50,egret.Ease.cubicInOut).to({x:-8},50,egret.Ease.cubicInOut).to({x:0},50,egret.Ease.cubicInOut)},t.prototype.showText=function(e,t,n,r){var a=this,i=new egret.TextField;i.y=.28*this.stageH,i.width=this.stageW,i.height=50,i.textAlign=egret.HorizontalAlign.CENTER,i.verticalAlign=egret.VerticalAlign.MIDDLE,i.textColor=n,i.text=t,i.size=50,i.strokeColor=r,i.stroke=4,i.alpha=0,i.zIndex=99;var o=function(){e.addChild(i),egret.Tween.get(i).to({alpha:1,y:.25*a.stageH},300).wait(200).to({alpha:0,y:.23*a.stageH},300).call(function(){i.y=.28*a.stageH,e.removeChild(i)})};return{show:o}},t.prototype.checkScoreIntoRank=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return[4,Http.PostRequest("/api/check-score",{score:e})];case 1:return t=n.sent(),t.success?[2,t.data.rank]:[2,-1]}})})},t}(egret.Sprite);__reflect(Game.prototype,"Game",["GameInterface"]);var Menu=function(e){function t(t,n){var r=e.call(this)||this;return r.stageW=t,r.stageH=n,r}return __extends(t,e),t.prototype.draw=function(){var e=new egret.Sprite;e.graphics.drawRect(0,0,this.stageW,this.stageH),e.graphics.endFill();var t=new egret.TextField;t.textColor=0,t.size=80,e.addChild(t),t.width=this.stageW,t.height=this.stageH,t.text="刮胡子",t.textAlign=egret.HorizontalAlign.CENTER,t.anchorOffsetX=this.stageW/2,t.x=this.stageW/2,t.y=this.stageH/10*3;var n=egret.Tween.get(t,{loop:!0});this.gameNameAnim(n);var r=new egret.Sprite;r.graphics.drawRect(0,0,400,400),r.x=this.stageW/2-200,r.y=this.stageH/2-200+200,r.graphics.endFill();var a=new egret.TextField;a.textColor=0,a.touchEnabled=!0,r.addChild(a),a.size=35,a.width=400,a.text="开始游戏",a.y=20,a.textAlign=egret.HorizontalAlign.CENTER,a.verticalAlign=egret.VerticalAlign.MIDDLE;var i=new egret.Event("startGame");a.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){SoundManager.getInstance().playButtonSound(),e.dispatchEvent(i)},a);var o=new egret.TextField;o.textColor=0,o.touchEnabled=!0,r.addChild(o),o.size=35,o.width=400,o.text="关于游戏",o.y=100,o.textAlign=egret.HorizontalAlign.CENTER,o.verticalAlign=egret.VerticalAlign.MIDDLE;var s=new egret.TextField;s.textColor=0,s.touchEnabled=!0,r.addChild(s),s.size=35,s.width=400,s.text="音乐："+(SoundManager.musicIsPlay?"开":"关"),s.y=180,s.textAlign=egret.HorizontalAlign.CENTER,s.verticalAlign=egret.VerticalAlign.MIDDLE;var l=new egret.TextField;l.textColor=0,l.touchEnabled=!0,r.addChild(l),s.size=35,l.width=400,l.text="排行榜",l.y=260,l.textAlign=egret.HorizontalAlign.CENTER,l.verticalAlign=egret.VerticalAlign.MIDDLE,e.addChild(r);var d=new egret.TextField;d.textColor=7372944,e.addChild(d),d.size=30,d.text="作者：低调哥",d.y=this.stageH/10*9,d.width=this.stageW,d.textAlign=egret.HorizontalAlign.CENTER,d.verticalAlign=egret.VerticalAlign.MIDDLE;var c=egret.localStorage.getItem(GAME_STORAGE_NAME),h=new egret.TextField;h.textColor=7372944,h.size=30,h.y=this.stageH/10*1,h.width=this.stageW,h.textAlign=egret.HorizontalAlign.CENTER,h.verticalAlign=egret.VerticalAlign.MIDDLE,c&&(h.text="最高纪录："+c,e.addChild(h));var u=!0;e.addEventListener("changeHistory",function(){var t=egret.localStorage.getItem(GAME_STORAGE_NAME);h.text="最高纪录："+t,e.addChild(h)},e);var g=this.drawAboutView(this.stageW,this.stageH);o.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){u=!1,SoundManager.getInstance().playButtonSound(),e.addChild(g)},o),g.addEventListener("close",function(){u=!0,SoundManager.getInstance().playButtonSound(),e.removeChild(g)},g),s.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){SoundManager.musicIsPlay=!SoundManager.musicIsPlay,s.text="音乐："+(SoundManager.musicIsPlay?"开":"关"),SoundManager.getInstance().playButtonSound()},s);var p=new Rank(this.stageW,this.stageH);return p.addEventListener("close",function(){e.removeChild(p)},null),l.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){u&&(SoundManager.getInstance().playButtonSound(),e.addChild(p),p.load())},s),e},t.prototype.gameNameAnim=function(e){e.to({rotation:10},999,egret.Ease.backInOut),e.to({rotation:-10},999,egret.Ease.backInOut).call(this.gameNameAnim.bind(this,e))},t.prototype.drawAboutView=function(e,t){var n=new egret.Sprite;n.zIndex=999,n.graphics.beginFill(0,.4),n.graphics.drawRect(0,0,e,t),n.graphics.endFill();var r=new egret.Sprite;r.graphics.lineStyle(5,0),r.graphics.beginFill(16777215),r.graphics.drawRoundRect(0,0,500,500,20,20),r.x=this.stageW/2-250,r.y=this.stageH/2-250,r.graphics.endFill();var a=new egret.Sprite;a.graphics.lineStyle(5,0),a.graphics.beginFill(16777215),a.graphics.drawCircle(0,0,30),a.x=500,a.graphics.endFill();var i=new egret.TextField;i.touchEnabled=!0,i.textColor=0,i.size=40,i.text="x",a.addChild(i),i.y=-20,i.x=-10;var o=new egret.TextField;o.textColor=0,o.size=42,o.text="关于游戏",r.addChild(o),o.y=40,o.width=500,o.textAlign=egret.HorizontalAlign.CENTER;var s=new egret.TextField;return s.textColor=0,s.size=32,s.text="瞧呐！！！快看看这个家伙，胡子长个不停。大家赶快来帮帮它。用手指划动或者点击脸部下巴的胡子，即可帮它拔掉，看看你们在规定的秒数内可以刮掉多少胡子。",r.addChild(s),s.lineSpacing=15,s.y=120,s.x=30,s.width=450,r.addChild(a),a.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.dispatchEvent(new egret.Event("close"))},a),n.addChild(r),n},t}(egret.Sprite);__reflect(Menu.prototype,"Menu",["MenuInter"]);var Rank=function(e){function t(t,n){var r=e.call(this)||this;r.stageW=t,r.stageH=n;var a=new egret.Sprite;return a.zIndex=999,a.graphics.beginFill(0,.4),a.graphics.drawRect(0,0,t,n),a.graphics.endFill(),r.addChild(a),r}return __extends(t,e),t.prototype.createChildren=function(){return __awaiter(this,void 0,void 0,function(){var t,n,r,a,i,o,s,l,d,c,h,u,g,p=this;return __generator(this,function(f){return t=460,n=400,e.prototype.createChildren.call(this),r=new eui.Group,r.width=t,r.height=n,a=new eui.Scroller,a.width=t,a.height=n,a.left=this.stageW/2-t/2,a.top=this.stageH/2-n/2+60,a.viewport=r,this.scroller=a,i=new eui.Rect,i.width=t+100,i.height=700,i.left=this.stageW/2-(t+100)/2,i.top=this.stageH/2-350,i.fillColor=16777215,i.strokeColor=0,i.strokeWeight=5,i.ellipseWidth=20,i.ellipseHeight=20,this.addChild(i),o='<e:Skin xmlns:e="http://ns.egret.com/eui" states="up,down" width="'+t+'" height="50"> \n            <e:Group width="'+t+'" height="50" >\n                <e:Label border="false" text="{data.rank}"  textAlign="left" verticalAlign="middle" width="60" height="50" textColor.up="0x000000" textColor.down="0x000000" horizontalCenter="0" verticalCenter="0"/> \n                <e:Label border="false" text="{data.playerName}" textAlign="center" verticalAlign="middle" width="300" height="50" textColor.up="0x000000" textColor.down="0x000000" horizontalCenter="0" verticalCenter="0"/> \n                <e:Label border="false" text="{data.score}" textAlign="right" verticalAlign="middle" width="100" height="50" textColor.up="0x000000" textColor.down="0x000000" horizontalCenter="0" verticalCenter="0"/> \n                <e:layout>\n                    <e:HorizontalLayout gap="0" verticalAlign="middle"/>\n                </e:layout>\n            </e:Group>\n        </e:Skin>',s=new eui.List,s.itemRendererSkinName=o,r.addChild(s),this.list=s,this.addChild(a),l=new eui.Label,l.text="排行榜",l.size=40,l.textColor=0,l.width=200,l.height=60,l.textAlign="center",l.x=this.stageW/2-100,l.y=.28*this.stageH-30,this.addChild(l),d=new eui.Group,d.width=t,d.height=60,c=new eui.HorizontalLayout,c.gap=0,c.verticalAlign="center",d.layout=c,h=[{text:"排名",width:60,align:"left"},{text:"玩家名称",width:300,align:"center"},{text:"得分",width:100,align:"right"}],h.forEach(function(e){var t=new eui.Label;t.text=e.text,t.width=e.width,t.textColor=0,t.textAlign=e.align,t.size=30,t.bold=!0,d.addChild(t)}),d.x=this.stageW/2-t/2,d.y=.36*this.stageH-30,this.addChild(d),u=new egret.Sprite,u.graphics.lineStyle(5,0),u.graphics.beginFill(16777215),u.graphics.drawCircle(0,0,30),u.x=this.stageW-55,u.y=230,u.graphics.endFill(),g=new egret.TextField,g.touchEnabled=!0,g.textColor=0,g.size=40,g.text="x",g.y=-20,g.x=-10,u.addChild(g),u.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){SoundManager.getInstance().playButtonSound(),p.dispatchEvent(new egret.Event("close"))},u),this.addChild(u),[2]})})},t.prototype.getRankList=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return[4,Http.GetRequest("/api/ranks")];case 1:return e=t.sent(),[2,e]}})})},t.prototype.load=function(){var e=this;return this.scroller.viewport.scrollV=0,Loading.getInstance().show(),IS_LOCAL?(this.list.dataProvider=new eui.ArrayCollection([]),void Loading.getInstance().hide()):void this.getRankList().then(function(t){t.success&&(e.list.dataProvider=new eui.ArrayCollection(t.data.ranks.map(function(e,t){return __assign({rank:t+1},e)
}))),Loading.getInstance().hide()})},t}(eui.Group);__reflect(Rank.prototype,"Rank");var BASE_URL="http://localhost:3000",IS_LOCAL=!0,Http;!function(e){function t(e,t){var n=this;return void 0===t&&(t={}),new Promise(function(r,a){var i=new egret.HttpRequest;i.responseType=egret.HttpResponseType.TEXT,i.open(BASE_URL+e,egret.HttpMethod.POST),i.setRequestHeader("Accept","application/json"),i.setRequestHeader("Content-Type","application/json");Object.keys(t);i.send(JSON.stringify(t)),i.addEventListener(egret.Event.COMPLETE,function(e){var t=e.currentTarget,n=JSON.parse(t.response);r(n)},n),i.addEventListener(egret.IOErrorEvent.IO_ERROR,function(e){var t=JSON.parse(i.response);Loading.getInstance().hide(),alert(t.errmsg),a(t)},n)})}function n(e){var t=this;return new Promise(function(n,r){var a=new egret.HttpRequest;a.responseType=egret.HttpResponseType.TEXT,a.open(BASE_URL+e,egret.HttpMethod.GET),a.send(),a.addEventListener(egret.Event.COMPLETE,function(e){var t=e.currentTarget,r=JSON.parse(t.response);n(r)},t),a.addEventListener(egret.IOErrorEvent.IO_ERROR,function(e){var t=JSON.parse(a.response);Loading.getInstance().hide(),alert(t.errmsg),r(e)},t)})}e.PostRequest=t,e.GetRequest=n}(Http||(Http={}));var musicIsPlay=!0;localStorage.getItem("musicPlay")?musicIsPlay="1"===localStorage.getItem("musicPlay")?!0:!1:localStorage.setItem("musicPlay","1");var SoundManager=function(){function e(){this.soundMap={},this.bgSoundPlaying=!1}return e.getInstance=function(){return e.shared||(e.shared=new e),e.shared},Object.defineProperty(e,"musicIsPlay",{get:function(){return musicIsPlay},set:function(e){musicIsPlay=e,localStorage.setItem("musicPlay",e?"1":"0")},enumerable:!0,configurable:!0}),e.prototype.loadSound=function(e){var t=new egret.Sound;return t.addEventListener(egret.IOErrorEvent.IO_ERROR,function(e){console.log("loaded error!"),alert("背景音乐加载失败")},this),t.load(e),t},e.prototype.playSound=function(e,t,n,r){return void 0===r&&(r=0),__awaiter(this,void 0,void 0,function(){var a,i,o=this;return __generator(this,function(s){switch(s.label){case 0:return a=null,i=null,this.soundMap[e]?[3,2]:(this.soundMap[e]={sound:a,soundChannel:i,play:!0,playing:!0},a=this.loadSound(n),[4,new Promise(function(n){a.addEventListener(egret.Event.COMPLETE,function(){o.soundMap[e].play&&(i=a.play(r,t)),n(i)},null)})]);case 1:return i=s.sent(),[3,3];case 2:if(a=this.soundMap[e].sound,!a.loaded)return[2];i=a.play(r,t),s.label=3;case 3:return 1===t&&i.addEventListener(egret.Event.SOUND_COMPLETE,function(){o.soundMap[e].playing=!1},null),this.soundMap[e]={sound:a,soundChannel:i,play:this.soundMap[e].play,playing:!0},[2,this.soundMap[e]]}})})},e.prototype.playButtonSound=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return e.musicIsPlay?[4,this.playSound("button",1,"resource/sounds/button.wav")]:[2];case 1:return t=n.sent().soundChannel,t.volume=.3,[2]}})})},e.prototype.playStartSound=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return e.musicIsPlay?[4,this.playSound("start",1,"resource/sounds/start.wav",.2)]:[2];case 1:return t=n.sent().soundChannel,t.volume=.3,[2]}})})},e.prototype.playWoWSound=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return e.musicIsPlay?[4,this.playSound("wowShout",1,"resource/sounds/wow.wav")]:[2];case 1:return t=n.sent().soundChannel,t.volume=.1,[2]}})})},e.prototype.playNiceSound=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return e.musicIsPlay?[4,this.playSound("niceShout",1,"resource/sounds/nice.wav")]:[2];case 1:return t=n.sent().soundChannel,t.volume=.1,[2]}})})},e.prototype.playShoutSound=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return e.musicIsPlay?this.soundMap.shout&&this.soundMap.shout.playing?[2]:[4,this.playSound("shout",1,"resource/sounds/shout.wav")]:[2];case 1:return t=n.sent().soundChannel,t.volume=.1,[2]}})})},e.prototype.playLongShoutSound=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return e.musicIsPlay?[4,this.playSound("longShout",1,"resource/sounds/longShout.wav")]:[2];case 1:return t=n.sent().soundChannel,t.volume=.1,[2]}})})},e.prototype.palyPullShoutSound=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return e.musicIsPlay?this.soundMap.pullShount&&this.soundMap.pullShount.playing?[2]:[4,this.playSound("pullShount",0,"resource/sounds/pullShout.wav")]:[2];case 1:return t=n.sent().soundChannel,this.soundMap.pullShount.soundChannel?(t.volume=.2,this.soundMap.pullShount.play=!0,this.soundMap.pullShount.playing=!0,[2]):[2]}})})},e.prototype.stopPullShoutSound=function(){e.musicIsPlay&&this.soundMap.pullShount&&(this.soundMap.pullShount.soundChannel&&this.soundMap.pullShount.soundChannel.stop(),this.soundMap.pullShount.play=!1,this.soundMap.pullShount.playing=!1)},e.prototype.playBgSound=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return e.musicIsPlay?this.soundMap.bg&&this.soundMap.bg.playing?[2]:[4,this.playSound("bg",0,"resource/sounds/bg.mp3")]:[2];case 1:return t=n.sent().soundChannel,t.volume=.3,[2]}})})},e.prototype.stopBgSound=function(){e.musicIsPlay&&(this.soundMap.bg.soundChannel.stop(),this.soundMap.bg.playing=!1)},e}();__reflect(SoundManager.prototype,"SoundManager");